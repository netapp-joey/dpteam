#!/usr/bin/env ansible-playbook
- hosts: localhost
  gather_facts: false
  vars:
    input: &input
      hostname: 192.168.0.102
      username: "admin"
      password: "Netapp1!"
      https: true
      validate_certs: false
      use_rest: always
  collections:
  - netapp.ontap
  tasks:
  - name: Create cluster2 aggrs
    na_ontap_aggregate:
      state: present
      service_state: online
      name: "{{ item.aggr }}"
      nodes: "{{ item.node }}"
      disk_count: 12
      <<: *input
    loop:
    - { aggr: 'cluster2_01_aggr', node: 'cluster2-01' }
    - { aggr: 'cluster2_02_aggr', node: 'cluster2-02' }
  - name: Create SVM on cluster2
    na_ontap_svm:
      state: present
      name: "{{ item.name }}"
      services:
        nfs:
          allowed: true
      <<: *input
    loop:
    - { name: 'svm1_cluster2' }
    - { name: 'svm2_cluster2' }
  - name: Peer SVMs
    na_ontap_vserver_peer:
      state: present
      vserver: "{{ item.srcsvm }}"
      peer_vserver: "{{ item.dstsvm }}"
      peer_cluster: "cluster1"
      applications: "snapmirror"
      peer_options:
        hostname: "cluster1"
      <<: *input
    loop:
    - { srcsvm: 'svm1_cluster2', dstsvm: 'svm1_cluster1' }
    - { srcsvm: 'svm2_cluster2', dstsvm: 'svm1_cluster1' }
    - { srcsvm: 'svm1_cluster2', dstsvm: 'svm2_cluster1' }
    - { srcsvm: 'svm2_cluster2', dstsvm: 'svm2_cluster1' }
